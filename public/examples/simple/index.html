<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Using Databases in R - Using Databases in R</title>
    <meta name="generator" content="Hugo 0.20" />

    
    <link rel="canonical" href="/examples/simple/">
    

    <meta property="og:url" content="/examples/simple/">
    <meta property="og:title" content="Using Databases in R">
    
    <meta name="apple-mobile-web-app-title" content="Using Databases in R">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('/fonts/icon.eot');
        src: url('/fonts/icon.eot')
               format('embedded-opentype'),
             url('/fonts/icon.woff')
               format('woff'),
             url('/fonts/icon.ttf')
               format('truetype'),
             url('/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="/stylesheets/application.css">
    <link rel="stylesheet" href="/stylesheets/temporary.css">
    <link rel="stylesheet" href="/stylesheets/palettes.css">
    <link rel="stylesheet" href="/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-light-blue palette-accent-green">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        <a href="/" title="db.rstudio.com">db.rstudio.com</a>
      </div>
    </div>


    
    <div class="button button-twitter" role="button" aria-label="Twitter">
       <a href="https://twitter.com/rstudio" title="@rstudio on Twitter" target="_blank" class="toggle-button icon icon-twitter"></a>
    </div>
    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/rstudio" title="@rstudio on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
   </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">



  <div class="scrollable">
    <div class="wrapper">

  
      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="/getting-started/">
	
	Getting started
</a>


  
</li>



<li>
  
    <span class="section">Analyzing</span>
    <ul>
      
        
        



<a  title="dplyr package" href="/dplyr/">
	
	dplyr package
</a>


      
        
        



<a  title="DBI package" href="/dbi/">
	
	DBI package
</a>


      
    </ul>
  
</li>



<li>
  
    <span class="section">Drivers</span>
    <ul>
      
        
        



<a  title="RStudio Drivers" href="/drivers/">
	
	RStudio Drivers
</a>


      
        
        



<a  title="Open source packages" href="/open-source/">
	
	Open source packages
</a>


      
    </ul>
  
</li>



<li>
  
    <span class="section">Best Practices</span>
    <ul>
      
        
        



<a  title="Secure credentials" href="/keyring/">
	
	Secure credentials
</a>


      
        
        



<a  title="Simplify connections" href="/config/">
	
	Simplify connections
</a>


      
    </ul>
  
</li>



<li>
  
    



<a  title="References" href="/">
	
	References
</a>


  
</li>



<li>
  
    



<a  title="Examples" href="/examples/">
	
	Examples
</a>


  
</li>


        </ul>
        

        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
		  <h1>Using Databases in R </h1>
			<!-- BLOGDOWN-HEAD -->
<!-- /BLOGDOWN-HEAD -->

<!-- BLOGDOWN-BODY-BEFORE -->
<!-- /BLOGDOWN-BODY-BEFORE -->
<div id="initial-setup" class="section level1">
<h1>Initial Setup</h1>
<div id="install-rstudios-odbc-drivers" class="section level2">
<h2>Install RStudio’s ODBC drivers</h2>
<p>The <a href="https://github.com/rstudio/odbc-install">odbc-install</a> repository has a script that simplifies the installation of the ODBC drivers in the client machine.</p>
<div id="red-hat-enterprise-linuxcentos-linux-6.0" class="section level3">
<h3>Red Hat Enterprise Linux/CentOS Linux (6.0+)</h3>
<p>There are two system dependencies that need to be installed prior to installing the drivers</p>
<pre><code>sudo yum install wget
sudo yum install unixODBC</code></pre>
<p>The following script will download and install the drivers:</p>
<pre><code># Placeholder path
wget -O - https://s3-us-west-2.amazonaws.com/rstudio-odbc/...</code></pre>
</div>
</div>
<div id="securing-credentials-using-the-keyring-package" class="section level2">
<h2>Securing Credentials using the keyring package</h2>
<p>The <a href="https://github.com/gaborcsardi/keyring">keyring</a> package enables us to access the operating system’s credential store.</p>
<pre class="r"><code>devtools::install_github(&quot;gaborcsardi/keyring&quot;)</code></pre>
<p>In this example, we will create a new key ring called <em>rstudio.odbc</em> and add a single key with the server path and credentials. Additional servers can be added to the same key ring by adding additional keys.</p>
<p>The way <strong>keyring</strong> retrieves data is by passing the Key Ring name and a <strong>service</strong> name. In this method, we will use the server path as the <strong>service</strong> so it will act as our key to retrieve user name and password to use for that particular server.</p>
<p>To prevent passing the server path in our code, we will use another package called <strong>config</strong>, which is discussed in the next section.</p>
<pre class="r"><code>keyring::keyring_create(&quot;rstudio.odbc&quot;)

keyring::key_set_with_value(service = &quot;sol-eng-sqlserv.cihykudhzbgw.us-west-2.rds.amazonaws.com&quot;, 
                            username = &quot;rstudioadmin&quot;, 
                            password = &quot;ABCd4321&quot;, 
                            keyring = &quot;rstudio.odbc&quot;)</code></pre>
</div>
<div id="simplify-connections-using-the-config-package" class="section level2">
<h2>Simplify connections using the config package</h2>
<p>The <a href="https://github.com/rstudio/config">config</a> package simplifies management of environment specific configuration values.</p>
<pre class="r"><code>devtools::install_github(&quot;rstudio/config&quot;)</code></pre>
<p>The values are saved in a YAML file called <strong>config.yml</strong>. The package also allows R code to be used as values, we will use this capability to retrieve the credentials from Key Ring.</p>
<p>This is the YAML file used for this exercise:</p>
<pre><code>  default:
    datawarehouse: 
      server: &quot;sol-eng-sqlserv.cihykudhzbgw.us-west-2.rds.amazonaws.com&quot;
      uid: !expr keyring::key_list(&quot;sol-eng-sqlserv.cihykudhzbgw.us-west-2.rds.amazonaws.com&quot;,  
           keyring = &quot;rstudio.odbc&quot;)[1,2]
      pwd: !expr keyring::key_get(&quot;sol-eng-sqlserv.cihykudhzbgw.us-west-2.rds.amazonaws.com&quot;,  
           keyring = &quot;rstudio.odbc&quot;)
      database: &quot;airontime&quot;</code></pre>
</div>
</div>
<div id="using-databases-for-analysis" class="section level1">
<h1>Using Databases for analysis</h1>
<div id="connecting-to-a-database-using-the-odbc-package" class="section level2">
<h2>Connecting to a Database using the odbc package</h2>
<p>The <a href="https://github.com/rstats-db/odbc">odbc</a> package provides a DBI-compliant interface to ODBC drivers. Drivers to a wide assortment of database types are provided as part of RStudio’s commercial products.</p>
<p><strong>Why is a DBI compliant interface important? </strong> Apart from enabling the analyst to leverage <a href="http://rstats-db.github.io/DBI/">DBI</a> for their analysis, it also opens the door for a <a href="https://github.com/tidyverse/dplyr">dplyr</a> back end to be developed which makes data wrangling transparent to the analysts since they can continue using the same <em>dplyr</em> commands.</p>
<pre class="r"><code>devtools::install_github(&quot;rstats-db/odbc&quot;)</code></pre>
<p>Use <strong>dbConnect</strong> to access the database. Passing the values from the <strong>config</strong> file enables us to protect the credentials and abstracts the server and database name in case we need to promote the code to point from a test to a production database.</p>
<pre class="r"><code>library(odbc)
library(config)
library(DBI)

con &lt;- dbConnect(odbc::odbc(), 
  .connection_string = paste0(&quot;Driver={sqlserver};
                              Server=&quot;, config::get(&quot;datawarehouse&quot;)$server ,&quot;;
                              Port=1433;
                              Database=&quot;, config::get(&quot;datawarehouse&quot;)$database ,&quot;;
                              UID=&quot;, config::get(&quot;datawarehouse&quot;)$uid ,&quot;;
                              PWD=&quot;, config::get(&quot;datawarehouse&quot;)$pwd ,&quot;;&quot;))</code></pre>
</div>
<div id="interacting-with-the-database-using-dbi" class="section level2">
<h2>Interacting with the database using DBI</h2>
<p>Here are a few basic DBI commands that can be used to access the database.</p>
<div id="list-tables" class="section level3">
<h3>List tables</h3>
<pre class="r"><code>dbListTables(con)</code></pre>
</div>
<div id="list-fields" class="section level3">
<h3>List Fields</h3>
<pre class="r"><code>dbListFields(con, &quot;mtcars&quot;)</code></pre>
</div>
<div id="run-a-query" class="section level3">
<h3>Run a query</h3>
<p>Using the appropriate SQL syntax for the type of connection, you can use the <strong>dbGetQuery</strong> run queries.</p>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT row_names, mpg, cyl FROM mtcars WHERE mpg &gt; 25 ORDER BY row_names&quot;)</code></pre>
</div>
</div>
<div id="analyzing-data-using-dplyr" class="section level2">
<h2>Analyzing data using dplyr</h2>
<div id="install-dbplyr" class="section level3">
<h3>Install dbplyr</h3>
<p>The new <a href="https://github.com/hadley/dbplyr">dbplyr</a> package has all of <em>dplyr</em>’s code related to databases, including the code that translates dplyr commands into vendor specific SQL commands. This separation will make it easier to release fixes for bugs that relate to database management.</p>
<pre class="r"><code>devtools::install_github(&quot;hadley/dbplyr&quot;)</code></pre>
</div>
<div id="using-dplyr" class="section level3">
<h3>Using dplyr</h3>
<pre class="r"><code>library(dplyr)
library(dbplyr)

mssql_mtcars &lt;- tbl(con, &quot;mtcars&quot;)

mssql_mtcars</code></pre>
<pre class="r"><code>mssql_mtcars %&gt;%
  select(row_names, mpg, cyl) %&gt;%
  filter(mpg &gt; 25) %&gt;%
  arrange(row_names)</code></pre>
</div>
<div id="disconnect" class="section level3">
<h3>Disconnect</h3>
<pre class="r"><code>dbDisconnect(con)</code></pre>
</div>
</div>
</div>


			<aside class="copyright" role="note">
	  <div class="text-muted">
     <p align = "right">Copyright RStudio, Inc. | All Rights Reserved</p>
    </div>
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="/examples/" title="Using Databases in R">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Using Databases in R
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="/index/" title="Using Databases in R">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Using Databases in R
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>







			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "¶";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

